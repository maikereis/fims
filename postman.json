{
    "info": {
        "_postman_id": "fims-api-collection-v2",
        "name": "FIMS API Test Suite",
        "description": "Field Installation Management System - Complete API Tests",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
        {
            "key": "baseUrl",
            "value": "http://localhost:8080"
        },
        {
            "key": "addressId",
            "value": ""
        },
        {
            "key": "clientId",
            "value": ""
        },
        {
            "key": "installationId",
            "value": ""
        },
        {
            "key": "contractId",
            "value": ""
        },
        {
            "key": "targetId",
            "value": ""
        },
        {
            "key": "serviceOrderId",
            "value": ""
        }
    ],
    "item": [
        {
            "name": "1. Health Checks",
            "item": [
                {
                    "name": "Address API Health",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": "{{baseUrl}}/api/addresses/check"
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Address API is UP', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Client API Health",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": "{{baseUrl}}/api/clients/check"
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Client API is UP', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Installation API Health",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": "{{baseUrl}}/api/installations/check"
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Installation API is UP', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Target API Health",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": "{{baseUrl}}/api/targets/check"
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Target API is UP', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "ServiceOrder API Health",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": "{{baseUrl}}/api/service-orders/check"
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('ServiceOrder API is UP', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "2. Address CRUD",
            "item": [
                {
                    "name": "Create Address",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('addressId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/addresses",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"addressId\": \"99999\",\n  \"state\": \"PA\",\n  \"municipality\": \"Belém\",\n  \"district\": \"Belém\",\n  \"neighborhood\": \"Cidade Nova\",\n  \"street\": \"Travessa WE 55\",\n  \"streetType\": \"Travessa\",\n  \"number\": \"250\",\n  \"zipCode\": \"66093-540\",\n  \"latitude\": -1.3894,\n  \"longitude\": -48.4587\n}"
                        }
                    }
                },
                {
                    "name": "Get All Addresses",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('OK', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/addresses"
                    }
                },
                {
                    "name": "Get Address by ID",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/addresses/{{addressId}}"
                    }
                },
                {
                    "name": "Delete Address",
                    "request": {
                        "method": "DELETE",
                        "url": "{{baseUrl}}/api/addresses/{{addressId}}"
                    }
                }
            ]
        },
        {
            "name": "3. Client CRUD",
            "item": [
                {
                    "name": "Create Client",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('clientId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/clients",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Maria Silva\",\n  \"cpf\": \"123.456.789-00\",\n  \"birthDate\": \"1985-03-15T00:00:00\",\n  \"motherName\": \"Ana Santos\",\n  \"genre\": \"Feminino\",\n  \"createdAt\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "Get All Clients",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/clients"
                    }
                },
                {
                    "name": "Get Client by ID",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/clients/{{clientId}}"
                    }
                },
                {
                    "name": "Delete Client",
                    "request": {
                        "method": "DELETE",
                        "url": "{{baseUrl}}/api/clients/{{clientId}}"
                    }
                }
            ]
        },
        {
            "name": "4. Installation CRUD",
            "item": [
                {
                    "name": "Create Address (if needed)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Address Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('addressId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/addresses",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"addressId\": \"ADDR-{{randomInt}}\",\n  \"state\": \"PA\",\n  \"municipality\": \"Belém\",\n  \"district\": \"\",\n  \"subdistrict\": \"\",\n  \"neighborhood\": \"\",\n  \"street\": \"Travessa WE 55\",\n  \"streetType\": \"Street\",\n  \"number\": \"123\",\n  \"complement\": \"\",\n  \"zipCode\": \"66000-000\",\n  \"latitude\": -1.455,\n  \"longitude\": -48.503\n}"
                        }
                    }
                },
                {
                    "name": "Create Installation",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Installation Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('installationId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/installations",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"address\": { \"id\": {{addressId}} },\n  \"createdAt\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "Get All Installations",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/installations"
                    }
                },
                {
                    "name": "Get Installation by ID",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/installations/{{installationId}}"
                    }
                },
                {
                    "name": "Update Installation",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/installations/{{installationId}}",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"address\": { \"id\": {{addressId}} },\n  \"createdAt\": \"{{$isoTimestamp}}\",\n  \"deletedAt\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "Delete Installation",
                    "request": {
                        "method": "DELETE",
                        "url": "{{baseUrl}}/api/installations/{{installationId}}"
                    }
                }
            ]
        },
        {
            "name": "5. ContractAccount CRUD",
            "item": [
                {
                    "name": "Create Client",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('clientId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/clients",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Test Client {{$timestamp}}\",\n  \"email\": \"client{{$timestamp}}@example.com\"\n}"
                        }
                    }
                },
                {
                    "name": "Create Installation",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('installationId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/installations",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"address\": { \"id\": {{addressId}} },\n  \"createdAt\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "Create Contract",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('contractId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/contract-accounts",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"accountNumber\": \"ACC-{{$timestamp}}\",\n  \"client\": { \"id\": {{clientId}} },\n  \"installation\": { \"id\": {{installationId}} },\n  \"status\": \"ON\",\n  \"createdAt\": \"{{$isoTimestamp}}\",\n  \"statusStart\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "Get All Contracts",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/contract-accounts"
                    }
                },
                {
                    "name": "Get Contract by ID",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/contract-accounts/{{contractId}}"
                    }
                },
                {
                    "name": "Update Contract Status",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/contract-accounts/{{contractId}}",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"accountNumber\": \"ACC-{{$timestamp}}\",\n  \"client\": { \"id\": {{clientId}} },\n  \"installation\": { \"id\": {{installationId}} },\n  \"status\": \"CUT\",\n  \"createdAt\": \"{{$isoTimestamp}}\",\n  \"statusStart\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "Delete Contract",
                    "request": {
                        "method": "DELETE",
                        "url": "{{baseUrl}}/api/contract-accounts/{{contractId}}"
                    }
                }
            ]
        },
        {
            "name": "6. Target CRUD",
            "item": [
                {
                    "name": "Create Target",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('targetId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/targets",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"contractAccount\": { \"id\": {{contractId}} },\n  \"type\": \"MACHINE_LEARNING\",\n  \"signature\": \"ML-{{$timestamp}}\",\n  \"score\": 0.85,\n  \"expectedCNR\": 1500.50,\n  \"expectedTicket\": 250.75,\n  \"distanceFromBase\": 5.2,\n  \"active\": true\n}"
                        }
                    }
                },
                {
                    "name": "Get All Targets",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/targets"
                    }
                },
                {
                    "name": "Get Target by ID",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/targets/{{targetId}}"
                    }
                },
                {
                    "name": "Get by Contract",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/targets/contract/{{contractId}}"
                    }
                },
                {
                    "name": "Get by Type",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/targets/type/MACHINE_LEARNING"
                    }
                },
                {
                    "name": "Get by Score Range",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{baseUrl}}/api/targets/score/between?min=0.5&max=1.0",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "targets",
                                "score",
                                "between"
                            ],
                            "query": [
                                {
                                    "key": "min",
                                    "value": "0.5"
                                },
                                {
                                    "key": "max",
                                    "value": "1.0"
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "Update Target",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Updated', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/targets/{{targetId}}",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"contractAccount\": { \"id\": {{contractId}} },\n  \"type\": \"MACHINE_LEARNING\",\n  \"signature\": \"ML-UPDATED\",\n  \"score\": 0.95,\n  \"expectedCNR\": 2000.00,\n  \"expectedTicket\": 300.00,\n  \"distanceFromBase\": 4.8,\n  \"active\": false\n}"
                        }
                    }
                },
                {
                    "name": "Delete Target",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Deleted', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "DELETE",
                        "url": "{{baseUrl}}/api/targets/{{targetId}}"
                    }
                }
            ]
        },
        {
            "name": "7. ServiceOrder CRUD",
            "item": [
                {
                    "name": "Create ServiceOrder",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Created', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('serviceOrderId', pm.response.json().id);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/service-orders",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"target\": { \"id\": {{targetId}} },\n  \"type\": \"IS_CUT\",\n  \"status\": \"CREATED\",\n  \"createdAt\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "Get All Orders",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/service-orders"
                    }
                },
                {
                    "name": "Get Order by ID",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/service-orders/{{serviceOrderId}}"
                    }
                },
                {
                    "name": "Get by Status",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/service-orders/status/CREATED"
                    }
                },
                {
                    "name": "Get by Target",
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/service-orders/target/{{targetId}}"
                    }
                },
                {
                    "name": "Update to EXECUTED",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/service-orders/{{serviceOrderId}}",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"target\": { \"id\": {{targetId}} },\n  \"type\": \"IS_CUT\",\n  \"status\": \"EXECUTED\",\n  \"createdAt\": \"{{$isoTimestamp}}\",\n  \"executedAt\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "Delete Order",
                    "request": {
                        "method": "DELETE",
                        "url": "{{baseUrl}}/api/service-orders/{{serviceOrderId}}"
                    }
                }
            ]
        },
        {
            "name": "8. Error Cases",
            "item": [
                {
                    "name": "404 - Not Found",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('404', () => pm.response.to.have.status(404));"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "url": "{{baseUrl}}/api/addresses/999999"
                    }
                },
                {
                    "name": "400 - Invalid CPF",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('400', () => pm.response.to.have.status(400));"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/clients",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Test\",\n  \"cpf\": \"invalid\",\n  \"createdAt\": \"{{$isoTimestamp}}\"\n}"
                        }
                    }
                },
                {
                    "name": "400 - Missing Required",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('400', () => pm.response.to.have.status(400));"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/addresses",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"number\": \"100\"\n}"
                        }
                    }
                },
                {
                    "name": "400 - Negative Score",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('400', () => pm.response.to.have.status(400));"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "url": "{{baseUrl}}/api/targets",
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"contractAccount\": { \"id\": 1 },\n  \"type\": \"RULES\",\n  \"score\": -0.5\n}"
                        }
                    }
                }
            ]
        }
    ]
}